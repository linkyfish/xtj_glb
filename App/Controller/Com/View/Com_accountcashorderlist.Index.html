<?php include _include(__APPDIR__.'Controller/Com/View/Public_head.html');?>
<body>
<div class="templatemo-flex-row">
    <?php include _include(__APPDIR__.'Controller/Com/View/Public_nav.html');?>

    <div class="templatemo-content col-1 light-gray-bg">
        <?php include _include(__APPDIR__.'Controller/Com/View/Public_top.html');?>
        <div class="row content" style="padding:5px 0px 0px 0px;">
            <section class="content">
                <div class="box box-primary box-solid">
                    <div class="box-header with-border">
                        <h3 class="box-title text-muted"><span style=" color:White;">提现订单查询<small
                                        style="margin-left:8px; margin-right:8px;"><a
                                            href="javascript:window.history.back()" target="_self"
                                            onclick='javascript:window.history.back();'><i class="fa fa-arrow-left"></i> 返回</a></small></span>
                        </h3>
                        <div class="box-tools pull-right">
                            <button data-widget="collapse" class="btn btn-box-tool" type="button"><i
                                        class="fa fa-minus"></i></button>
                        </div>
                    </div>

                    <div class="box-body">
                        <div class="form-group div_h_1" style="display:none;">
                            <label>查询条件</label>
                            <select id="QueryList" class="form-control">
                                <option value="-1">查询所有</option>
                                <option value="20">处理成功</option>
                                <option value="10">等待处理</option>
                                <option value="40">取消订单</option>
                                <option value="30">禁用订单</option>
                               	<option value="50">代付执行中</option>
                               	<option value="60">代付失败</option>
                            </select>
                        </div>
                        <div class="form-group div_h_1" style="display:none;">
                            <label>代付平台</label>
                            <select id="RepayList" class="form-control">
                                <option value="-1">查询所有</option>
								<?php foreach($repay_config as $repay){ ?>
                                <option value="<?=$repay['ID']?>"><?=$repay['Name']?></option>
								<?php } ?>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>会员ID</label>
                            <input type="text" class="form-control" id="txt_UserName" maxlength="17"
                                   placeholder="选填项,需要按会员查询时填会员帐号">
                        </div>

                        <div class="form-group div_h_1" style="display:none;">
                            <label>开始日期</label>
                            <input type="text" class="form-control" id="txt_StartDateTime" maxlength="10"
                                   onClick="WdatePicker();">
                        </div>

                        <div class="bootstrap-timepicker div_h_1" id="begin_tp" style="display:none;">
                            <div class="bootstrap-timepicker-widget dropdown-menu">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td><a data-action="incrementHour" href="#"><i
                                                        class="glyphicon glyphicon-chevron-up"></i></a></td>
                                        <td class="separator">&nbsp;</td>
                                        <td><a data-action="incrementMinute" href="#"><i
                                                        class="glyphicon glyphicon-chevron-up"></i></a></td>
                                        <td class="separator">&nbsp;</td>
                                        <td class="meridian-column"><a data-action="toggleMeridian" href="#"><i
                                                        class="glyphicon glyphicon-chevron-up"></i></a></td>
                                    </tr>
                                    <tr>
                                        <td><span class="bootstrap-timepicker-hour">09</span></td>
                                        <td class="separator">:</td>
                                        <td><span class="bootstrap-timepicker-minute">00</span></td>
                                        <td class="separator">&nbsp;</td>
                                        <td><span class="bootstrap-timepicker-meridian">AM</span></td>
                                    </tr>
                                    <tr>
                                        <td><a data-action="decrementHour" href="#"><i
                                                        class="glyphicon glyphicon-chevron-down"></i></a></td>
                                        <td class="separator"></td>
                                        <td><a data-action="decrementMinute" href="#"><i
                                                        class="glyphicon glyphicon-chevron-down"></i></a></td>
                                        <td class="separator">&nbsp;</td>
                                        <td><a data-action="toggleMeridian" href="#"><i
                                                        class="glyphicon glyphicon-chevron-down"></i></a></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="form-group">
                                <label class="text-aqua"> - 时间</label>
                                <div class="input-group">
                                    <input type="text" class="form-control timepicker" id="txt_StartDateTime_HM">
                                    <div class="input-group-addon">
                                        <i class="fa fa-clock-o"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group div_h_1" style="display:none;">
                            <label>结束日期</label>
                            <input type="text" class="form-control" id="txt_EndDateTime" maxlength="10"
                                   onClick="WdatePicker();">
                        </div>

                        <div class="bootstrap-timepicker div_h_1" id="end_tp" style="display:none;">
                            <div class="bootstrap-timepicker-widget dropdown-menu">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td><a data-action="incrementHour" href="#"><i
                                                        class="glyphicon glyphicon-chevron-up"></i></a></td>
                                        <td class="separator">&nbsp;</td>
                                        <td><a data-action="incrementMinute" href="#"><i
                                                        class="glyphicon glyphicon-chevron-up"></i></a></td>
                                        <td class="separator">&nbsp;</td>
                                        <td class="meridian-column"><a data-action="toggleMeridian" href="#"><i
                                                        class="glyphicon glyphicon-chevron-up"></i></a></td>
                                    </tr>
                                    <tr>
                                        <td><span class="bootstrap-timepicker-hour">09</span></td>
                                        <td class="separator">:</td>
                                        <td><span class="bootstrap-timepicker-minute">00</span></td>
                                        <td class="separator">&nbsp;</td>
                                        <td><span class="bootstrap-timepicker-meridian">AM</span></td>
                                    </tr>
                                    <tr>
                                        <td><a data-action="decrementHour" href="#"><i
                                                        class="glyphicon glyphicon-chevron-down"></i></a></td>
                                        <td class="separator"></td>
                                        <td><a data-action="decrementMinute" href="#"><i
                                                        class="glyphicon glyphicon-chevron-down"></i></a></td>
                                        <td class="separator">&nbsp;</td>
                                        <td><a data-action="toggleMeridian" href="#"><i
                                                        class="glyphicon glyphicon-chevron-down"></i></a></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="form-group">
                                <label class="text-aqua"> - 时间</label>
                                <div class="input-group">
                                    <input type="text" class="form-control timepicker" ID="txt_EndDateTime_HM">
                                    <div class="input-group-addon">
                                        <i class="fa fa-clock-o"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="box-footer">
                        <button type="button" class="btn btn-primary" id="Button_OK">开始查询</button>
                        <button type="button" class="btn bg-navy margin" id="bt_XiaFenReport">下分统计</button>
                    </div>
                    <div class="box-body no-padding" style="display:block;display:none;" id="show_total">
                        <ul class="nav nav-pills nav-stacked">
                            <li><a href="#"><i class="fa fa-circle-o text-aqua"></i> 查询笔数：<span id="td_totalSumData"
                                                                                                class="text-bold"></span></a>
                            </li>
                            <li class="normalTotal"><a href="#"><i class="fa fa-circle-o text-green"></i> 成功提现：<span
                                            id="td_total_Success_Sum" class="text-bold"></span></a></li>
                            <li class="normalTotal"><a href="#"><i class="fa fa-circle-o text-green"></i> 代付金额：<span
                                            id="td_total_daifu_Sum" class="text-bold"></span></a></li>
                            <li class="normalTotal"><a href="#"><i class="fa fa-circle-o text-yellow"></i> 等待处理：<span
                                            id="td_totalFailData" class="text-bold"></span></a></li>
                            <li class="normalTotal"><a href="#"><i class="fa fa-circle-o text-red"></i> 取消订单：<span
                                            id="td_total_Fail_Sum" class="text-bold"></span></a></li>
                            <li class="totalCurrRow"><a href="#"><i class="fa fa-circle-o text-light-blue"></i>
                                    累计提现：<span id="td_totalCurrRow" class="text-bold"></span></a></li>
                            <li class="totalSeviceFee"><a href="#"><i class="fa fa-circle-o text-gray"></i> 累计服务费：<span
                                            id="td_serviceFee" class="text-bold"></span></a></li>
                        </ul>
                    </div>

                </div>
                <!--数据列表-->
                <div class="box box-primary box-solid" id="tb_list_1" style="display:none;">
                    <div class="box-header with-border">
                        <h3 class="box-title"><span style=" color:White;">详情列表</span></h3>
                        <div class="box-tools pull-right">
                            <button data-widget="collapse" class="btn btn-box-tool" type="button"><i
                                        class="fa fa-minus"></i></button>
                        </div>
                    </div>
                    <div class="box-body" style="display: block;padding:0px;">
                        <div class="table-responsive">

                            <table class="tablesorter table table-hover table-bordered">
                                <thead>
                                <tr>
                                    <th nowrap='nowrap'>序号</th>
                                    <th nowrap='nowrap'>数据编号</th>
                                    <th nowrap='nowrap'>用户名</th>
                                    <th nowrap='nowrap'>操作人</th>
                                    <th nowrap='nowrap'>会员ID</th>
                                    <th nowrap='nowrap'>操作方式</th>
                                    <th nowrap='nowrap'>订单状态</th>
                                    <th nowrap='nowrap'>提现金额</th>
                                    <th nowrap='nowrap'>之前金额</th>
                                    <th nowrap='nowrap'>之后金额</th>
                                    <th nowrap='nowrap'>订单号</th>
                                    <th nowrap='nowrap'>订单日期</th>
                                    <th nowrap='nowrap'>详情</th>
                                </tr>
                                </thead>
                                <tbody id="tblData"></tbody>
                            </table>

                        </div>
                        <!--Pager-->
                        <div id="Pagination" class="pull-left"></div>
                    </div>
                </div>
                <!--下分统计列表 开始-->
                <div class="box box-primary box-solid" id="tb_list_2" style="display:none;">
                    <div class="box-header with-border">
                        <h3 class="box-title"><span style=" color:White;">详情列表</span></h3>
                        <div class="box-tools pull-right">
                            <button data-widget="collapse" class="btn btn-box-tool" type="button"><i
                                        class="fa fa-minus"></i></button>
                        </div>
                    </div>
                    <div class="box-body" style="display: block;padding:0px;">
                        <div class="table-responsive">

                            <table class="table table-hover table-bordered">
                                <thead>
                                <tr>
                                    <th nowrap='nowrap'>序号</th>
                                    <th nowrap='nowrap'>操作帐号</th>
                                    <th nowrap='nowrap'>操作笔数</th>
                                    <th nowrap='nowrap'>下发总额</th>
                                    <th nowrap='nowrap'>人工减分</th>
                                    <th nowrap='nowrap'>取消订单</th>
                                    <th nowrap='nowrap'>禁用订单</th>
                                    <th nowrap='nowrap'>累计服务费</th>
                                </tr>
                                </thead>
                                <tbody id="tblData2"></tbody>
                            </table>

                        </div>
                        <!--Pager-->

                    </div>
                </div>
                <!--下分统计列表 结束-->
            </section>
            <script src="/res/js/WdatePicker.js" type="text/javascript"></script>
            <script src="/res/js/jquery-ui.min.js"></script>
            <script src="/res/js/bootstrap-timepicker.min.js" type="text/javascript"></script>
            <script src="/res/js/laypage.js" type="text/javascript"></script>
            <script type="text/javascript">
                function getDataList2() {
                    var a, b, c, d;
                    return $("#tb_list_2").hide(), $.trim($("#txt_StartDateTime").val()).length <= 0 || $.trim($("#txt_EndDateTime").val()).length <= 0 ? (web_tips("日期时间不能为空."), !1) : (a = $("#txt_StartDateTime").val(), b = $("#txt_StartDateTime_HM").val(), c = $("#txt_EndDateTime").val(), d = $("#txt_EndDateTime_HM").val(), _sDate = a + " " + b, _eDate = c + " " + d, $.ajax({
                        url: "../ashx/platOrder/accountCashOrder.ashx",
                        type: "post",
                        dataType: "json",
                        data: {action: "Report_CashOrder", sDate: _sDate, eDate: _eDate, CurDateTime: getCurrDate()},
                        success: function (a) {
                            if (a.success) if (a.results.length > 0) {
                                $("#tb_list_2 tr:gt(0)").remove();
                                var b = "";
                                $.each(a.results, function (c) {
                                    b += '<tr class="tr_h">',
                                    b += "<td>",
                                    b += c + 1,
                                    b += "</td>",
                                    b += "<td>",
                                    b += a.results[c].Account,
                                    b += "</td>",
                                    b += '<td><span class="badge bg-gray">',
                                    b += a.results[c].TotalNum,
                                    b += "</span></td>",
                                    b += '<td><span class="badge bg-gray">',
                                    b += a.results[c].TotalCashNum,
                                    b += "</span></td>",
                                    b += '<td><span class="badge bg-gray">',
                                    b += a.results[c].TotalRenGong,
                                    b += "</span></td>",
                                    b += '<td><span class="badge bg-gray">',
                                    b += a.results[c].TotalSys,
                                    b += "</span></td>",
                                    b += '<td><span class="badge bg-gray">',
                                    b += a.results[c].TotalCancel,
                                    b += "</span></td>",
                                    b += '<td><span class="badge bg-gray">',
                                    b += a.results[c].TotalFeeNum,
                                    b += "</span></td>",
                                    b += "</tr>"
                                }), $("#tblData2").append(b), $("#tb_list_2").show(), layer.close(pagei)
                            } else layer.close(pagei), $("#tb_list_2").fadeOut(1000), web_tips(a.msg =='操作成功'?"暂无记录":a.msg); else layer.close(pagei), $("#tb_list_2").fadeOut(1000), global_Error500 == a.ERROR_TYPE && (parent.location.href = global_e_p_500), global_NoLicense != a.msg ? web_tips(a.msg =='操作成功'?"暂无记录":a.msg) : parent.location.href = global_jump_login
                        },
                        beforeSend: function () {
                            $("#bt_XiaFenReport").attr("disabled", "disabled").text("正在查询"), pagei = layer.msg('请稍候..', {icon: 16,shadeClose: !1,shade: 0.01})
                        },
                        complete: function () {
                            $("#bt_XiaFenReport").removeAttr("disabled").text("下分统计")
                        }
                    }), void 0)
                }

                function getDataList(a) {
                    var b, c, d, e, f;
                    return $("#tb_list_1,#show_total").hide(), _totalSuccessSum = 0, _totalServiceFee = 0, _totalFailData = 0, _totalFailSum = 0, _totalCurrRow = 0, b = a, _QueryID = $("#QueryList").val(), _RepayID = $("#RepayList").val(), -1 == _QueryID ? ($(".totalCurrRow").hide(), $(".normalTotal").show()) : ($(".normalTotal").hide(), $(".totalCurrRow").show()), $.trim($("#txt_StartDateTime").val()).length <= 0 || $.trim($("#txt_EndDateTime").val()).length <= 0 ? (web_tips("日期时间不能为空."), !1) : (c = $("#txt_StartDateTime").val(), d = $("#txt_StartDateTime_HM").val(), e = $("#txt_EndDateTime").val(), f = $("#txt_EndDateTime_HM").val(), _sDate = c + " " + d, _eDate = e + " " + f, _user = $("#txt_UserName").val(), $.ajax({
                        url: "../ashx/platOrder/accountCashOrder.ashx",
                        type: "post",
                        dataType: "json",
                        data: {
                            action: "QueryCashOrder",
                            QueryID: _QueryID,
                            RepayID: _RepayID,
                            sDate: _sDate,
                            eDate: _eDate,
                            user: _user,
                            pageIndex: b + 1,
                            pageSize: pageSize,
                            CurDateTime: getCurrDate()
                        },
                        success: function (a) {
                            var c, d;
                            a.success ? (c = a.total, _totalSuccessSum = a.total_SuccessSum, _totalFailData = a.total_FailData, _totalFailSum = a.total_FailSum, a.total > 0 ? ($("#tb_list_1 tr:gt(0)").remove(), d = "", $.each(a.results, function (b) {
                                var i, j, k, l, e = a.results[b].ID, f = a.results[b].OrderID,
                                    g = a.results[b].UserName, h = parseFloat(a.results[b].CashNum).toFixed(2);
                                switch (_totalCurrRow += Number(a.results[b].CashNum), i = a.results[b].OrderStatus, k = a.results[b].OrderStatus, i) {

                                    case 10:
                                        j = '<span class="badge bg-gray bg_flag">' + arr_State[0] + "</span>";
                                        break;
                                    case 20:
                                        j = '<span class="badge bg-green">' + arr_State[1] + "</span>", _totalServiceFee += Number(a.results[b].ServiceFee);
                                        break;
                                    case 40:
                                        j = '<span class="badge bg-red bg_flag">' + arr_State[2] + "</span>";
                                        break;
                                    case 50:
                                        j = '<span class="badge bg-light-red bg_flag">' + arr_State[3] + "</span>";
                                        break;
                                    case 30:
                                        j = '<span class="badge bg-light-blue bg_flag">' + arr_State[4] + "</span>"
                                }
                                l = a.results[b].RepayID?arr_repay[a.results[b].RepayID]:arr_Action[k],

                                d += '<tr class="tr_h">',
                                d += "<td>",
                                d += a.results[b].Rownum,
                                d += "</td>",
                                d += '<td><span class="badge bg-gray">',
                                d += e,
                                d += "</span></td>",
                                d += "<td>",
                                d += a.results[b].BankOwner,
                                d += "</td>",
									d += "<td>",
                                d += a.results[b].Account,
                                d += "</td>",
                                d += "<td>",
                                d += g+'('+a.results[b].UserID+')',
                                d += "</td>",
                                d += '<td><span class="badge bg-gray">',
                                d += l,
                                d += "</span></td>",
                                d += "<td>",
                                d += j,
                                d += "</td>",
                                d += '<td><span class="badge bg-gray">',
                                d += h,
                                d += "</span></td>",
                                d += '<td><span class="badge bg-gray">',
                                d += parseFloat(a.results[b].BeforeMoney).toFixed(2),
                                d += "</span></td>",
                                d += '<td><span class="badge bg-gray">',
                                d += parseFloat(a.results[b].AfterMoney).toFixed(2),
                                d += "</span></td>",
                                d += '<td nowrap="nowrap">',
                                d += f,
                                d += "</td>",
                                d += '<td nowrap="nowrap">',
                                d += a.results[b].C_DateTime,
                                d += "</td>",
                                d += "<td>",
                                d += 10 == i ? '<button type="button" class="btn bg-navy btn-xs btflag" title="' + g + '" onfocus="this.blur();" onclick=\'onCashData_Detail(this,"' + e+ '","' + a.results[b].UserName + "\");'>数据详情</button>" : '<button type="button" class="btn btn-default btn-xs btflag" title="' + g + '" onfocus="this.blur();" onclick=\'onCashData_ViewDetail(this,"' + e + '","' + a.results[b].UserName + "\");'>银行信息</button>", d += "</td>", d += "</tr>"
                            }), $("#tblData").append(d), $(".tablesorter").trigger("update"), $("#td_totalSumData").text(c), $("#td_total_Success_Sum").text(parseFloat(_totalSuccessSum).toFixed(2)),$("#td_total_daifu_Sum").text(parseFloat(a.total_DaifuSum).toFixed(2)), $("#td_totalFailData").text(_totalFailData), $("#td_total_Fail_Sum").text(_totalFailSum), $("#td_serviceFee").text(a.total_ServiceSum), 1 == _QueryID ? $("#td_totalCurrRow").text(parseFloat(_totalSuccessSum).toFixed(2)) : $("#td_totalCurrRow").text(_totalFailSum), $("#tb_list_1,#show_total").show(), layer.close(pagei), laypage({
                                cont: "Pagination",
                                pages: numPages(c, pageSize),
                                skip: !0,
                                skin: "molv",
                                first: 1,
                                last: numPages(c, pageSize),
                                prev: "<",
                                next: ">",
                                curr: b + 1,
                                groups: 5,
                                jump: function (a, b) {
                                    b || pageselectCallback(a.curr - 1)
                                }
                            })) : (layer.close(pagei), $("#tb_list_1,#show_total").fadeOut(1000), web_tips(a.msg =='操作成功'?"暂无记录":a.msg))) : (layer.close(pagei), $("#tb_list_1,#show_total").fadeOut(1000), global_Error500 == a.ERROR_TYPE && (parent.location.href = global_e_p_500), global_NoLicense != a.msg ? web_tips(a.msg =='操作成功'?"暂无记录":a.msg) : parent.location.href = global_jump_login)
                        },
                        beforeSend: function () {
                            $("#Button_OK").attr("disabled", "disabled").text("正在查询"), pagei = layer.msg('请稍候..', {icon: 16,shadeClose: !1,shade: 0.01})

                        },
                        complete: function () {
                            $("#Button_OK").removeAttr("disabled").text("开始查询")
                        }
                    }), void 0)
                }

                function pageselectCallback(a) {
                    getDataList(a)
                }


                var pagei, pageIndex = 0, pageSize = 50, _user = "", _sDate, _eDate, _totalSuccessSum = 0,
                    _totalServiceFee = 0, _totalFailData = 0, _totalFailSum = 0, _QueryID,_RepayID, _totalCurrRow = 0,
                    _curr_Info = "1", arr_State = ["待处理", "成功", "取消", "待回执", "禁用"],
                    arr_Action = {10:"-",20:"人工打款",40:"取消订单",30:"禁用"};
                	arr_repay = <?php echo json_encode(arrlist_key_values($repay_config,'ID','Name'))?>;
                $(function () {
                    switch ($("#txt_StartDateTime,#txt_EndDateTime").attr("value", getCurrDate()), _curr_Info) {
                        case"8":
                        case"9":
                        case"12":
                            $(".div_h_1").hide();
                            break;
                        default:
                            $(".div_h_1").show()
                    }
                    $(".tablesorter").tablesorter({
                        headers: {
                            0: {sorter: "integer"},
                            1: {sorter: "integer"},
                            6: {sorter: "currency"},
                            7: {sorter: "currency"},
                            8: {sorter: "currency"},
                            9: {sorter: !1},
                            11: {sorter: !1}
                        }
                    }),$("#txt_StartDateTime_HM").timepicker({
                        defaultTime: "00:00:00",
                        showInputs: !1,
                        showMeridian: !1,
                        showSeconds: !0,
                        minuteStep: 5,
                        secondStep: 15
                    }), $("#txt_EndDateTime_HM").timepicker({
                        defaultTime: "23:59:59",
                        showInputs: !1,
                        showMeridian: !1,
                        showSeconds: !0,
                        minuteStep: 5,
                        secondStep: 15
                    }), $("#Button_OK").click(function () {
                        $("#tb_list_2").hide(), $("#Pagination").html(""), getDataList(0)
                    }), $("#bt_XiaFenReport").click(function () {
                        $("#tb_list_1,#show_total").hide(), $("#tb_list_2").hide(), getDataList2()
                    })
                });
            </script>

        </div>
    </div>
</div>


<?php include _include(__APPDIR__.'Controller/Com/View/Public_footjs.html');?>