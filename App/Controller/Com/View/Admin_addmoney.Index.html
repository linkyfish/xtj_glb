<?php include _include(__APPDIR__ . 'Controller/Com/View/Public_head.html'); ?>
	<body>
<div class="templatemo-flex-row">
	<?php include _include(__APPDIR__ . 'Controller/Com/View/Public_nav.html'); ?>

	<div class="templatemo-content col-1 light-gray-bg">
		<?php include _include(__APPDIR__ . 'Controller/Com/View/Public_top.html'); ?>
		<div class="row content" style="padding:5px 0px 0px 0px;">
			<section class="content">
				<div class="box box-primary box-solid">
					<div class="box-header with-border">
						<h3 class="box-title text-muted"><span style=" color:White;">上分记录查询<small
										style="margin-left:8px; margin-right:8px;"><a
											href="javascript:window.history.back()" target="_self"
											onclick='javascript:window.history.back();'><i class="fa fa-arrow-left"></i> 返回</a></small></span>
						</h3>
						<div class="box-tools pull-right">
							<button data-widget="collapse" class="btn btn-box-tool" type="button"><i
										class="fa fa-minus"></i></button>
						</div>
					</div>

					<div class="box-body">

						<div class="form-group">
							<label>会员ID</label>
							<input type="text" class="form-control" id="txt_UserName" maxlength="17"
								   placeholder="选填项,需要按会员查询时填会员帐号">
						</div>

 						<div class="form-group" style="<?php echo ($_role['RoleID']<3||$_role['RoleID']==103||$_role['RoleID']==104)?"":"display:none;" ?>">
							<label>上分子账户</label>
							<select id="ShangHuListID" class="form-control">
								<option value="0" selected>查询所有</option>
								<?php foreach ($_accs as $_acc){ ?>
									<option value="<?=$_acc['id']?>"><?=$_acc['id']?> - <?=$_acc['username']?></option>
								<?php } ?>
							</select>
						</div>

						<div class="form-group div_h_1">
							<label>开始日期</label>
							<input type="text" class="form-control" id="txt_StartDateTime" maxlength="10"
								   value="<?php echo date('H') <= 12 ? date('Y-m-d', time()) : date('Y-m-d') ?>"
								   onClick="WdatePicker();">
						</div>

						<div class="bootstrap-timepicker div_h_1" id="begin_tp">
							<div class="bootstrap-timepicker-widget dropdown-menu">
								<table>
									<tbody style="">
									<tr>
										<td><a data-action="incrementHour" href="#"><i
														class="glyphicon glyphicon-chevron-up"></i></a></td>
										<td class="separator">&nbsp;</td>
										<td><a data-action="incrementMinute" href="#"><i
														class="glyphicon glyphicon-chevron-up"></i></a></td>
										<td class="separator">&nbsp;</td>
										<td class="meridian-column"><a data-action="toggleMeridian" href="#"><i
														class="glyphicon glyphicon-chevron-up"></i></a></td>
									</tr>
									<tr>
										<td><span class="bootstrap-timepicker-hour">12</span></td>
										<td class="separator">:</td>
										<td><span class="bootstrap-timepicker-minute">00</span></td>
										<td class="separator">&nbsp;</td>
										<td><span class="bootstrap-timepicker-meridian">AM</span></td>
									</tr>
									<tr>
										<td><a data-action="decrementHour" href="#"><i
														class="glyphicon glyphicon-chevron-down"></i></a></td>
										<td class="separator"></td>
										<td><a data-action="decrementMinute" href="#"><i
														class="glyphicon glyphicon-chevron-down"></i></a></td>
										<td class="separator">&nbsp;</td>
										<td><a data-action="toggleMeridian" href="#"><i
														class="glyphicon glyphicon-chevron-down"></i></a></td>
									</tr>
									</tbody>
								</table>
							</div>
							<div class="form-group">
								<label class="text-aqua"> - 时间</label>
								<div class="input-group">
									<input type="text" class="form-control timepicker" id="txt_StartDateTime_HM">
									<div class="input-group-addon">
										<i class="fa fa-clock-o"></i>
									</div>
								</div>
							</div>
						</div>

						<div class="form-group div_h_1">
							<label>结束日期</label>
							<input type="text" class="form-control" id="txt_EndDateTime" maxlength="10"
								   onClick="WdatePicker();"
								   value="<?php echo date('H') <= 12 ? date('Y-m-d') : date('Y-m-d', time()) ?>">
						</div>

						<div class="bootstrap-timepicker div_h_1" id="end_tp">
							<div class="bootstrap-timepicker-widget dropdown-menu">
								<table>
									<tbody>
									<tr>
										<td><a data-action="incrementHour" href="#"><i
														class="glyphicon glyphicon-chevron-up"></i></a></td>
										<td class="separator">&nbsp;</td>
										<td><a data-action="incrementMinute" href="#"><i
														class="glyphicon glyphicon-chevron-up"></i></a></td>
										<td class="separator">&nbsp;</td>
										<td class="meridian-column"><a data-action="toggleMeridian" href="#"><i
														class="glyphicon glyphicon-chevron-up"></i></a></td>
									</tr>
									<tr>
										<td><span class="bootstrap-timepicker-hour">12</span></td>
										<td class="separator">:</td>
										<td><span class="bootstrap-timepicker-minute">59</span></td>
										<td class="separator">&nbsp;</td>
										<td><span class="bootstrap-timepicker-meridian">AM</span></td>
									</tr>
									<tr>
										<td><a data-action="decrementHour" href="#"><i
														class="glyphicon glyphicon-chevron-down"></i></a></td>
										<td class="separator"></td>
										<td><a data-action="decrementMinute" href="#"><i
														class="glyphicon glyphicon-chevron-down"></i></a></td>
										<td class="separator">&nbsp;</td>
										<td><a data-action="toggleMeridian" href="#"><i
														class="glyphicon glyphicon-chevron-down"></i></a></td>
									</tr>
									</tbody>
								</table>
							</div>
							<div class="form-group">
								<label class="text-aqua"> - 时间</label>
								<div class="input-group">
									<input type="text" class="form-control timepicker" ID="txt_EndDateTime_HM">
									<div class="input-group-addon">
										<i class="fa fa-clock-o"></i>
									</div>
								</div>
							</div>
						</div>

					</div>

					<div class="box-footer">
						<button type="button" class="btn btn-primary" id="Button_OK">确定</button>
					</div>
					<div class="box-body no-padding" style="display:block;" id="show_total">
						<ul class="nav nav-pills nav-stacked">
							<li><a href="#"><i class="fa fa-circle-o text-aqua"></i> 查询笔数：<span id="td_totalSumData"
																								class="text-bold"></span></a>
							</li>
							<li class="normalTotal"><a href="#"><i class="fa fa-circle-o text-green"></i> 加分总额：<span
											id="td_total_Success_Sum" class="text-bold"></span></a></li>
							<li class="normalTotal"><a href="#"><i class="fa fa-circle-o text-yellow"></i> 减分总额：<span
											id="td_totalFailData" class="text-bold"></span></a></li>
							<li class="totalCurrRow"><a href="#"><i class="fa fa-circle-o text-light-blue"></i>
									累计总额：<span id="td_totalCurrRow" class="text-bold"></span></a></li>
						</ul>
					</div>

				</div>
				<!--数据列表-->
				<div class="box box-primary box-solid" id="tb_list_1">
					<div class="box-header with-border">
						<h3 class="box-title text-bold"><span style=" color:White;">详情列表</span></h3>
						<div class="box-tools pull-right">
							<button data-widget="collapse" class="btn btn-box-tool" type="button"><i
										class="fa fa-minus"></i></button>
						</div>
					</div>
					<div class="box-body" style="display: block;padding:0px;">
						<div class="table-responsive">

							<table class="tablesorter table table-hover table-bordered">
								<thead>
								<tr>
									<th nowrap='nowrap'>序号</th>
									<th nowrap='nowrap'>会员ID</th>
									<th nowrap='nowrap'>金额</th>
									<th nowrap='nowrap'>操作员</th>
									<th nowrap='nowrap'>时间</th>
									<th nowrap='nowrap'>IP</th>
								</tr>
								</thead>
								<tbody id="tblData"></tbody>
							</table>

						</div>
						<!--Pager-->
						<div id="Pagination" class="pull-left"></div>
					</div>
				</div>
			</section>
			<script src="/res/js/WdatePicker.js" type="text/javascript"></script>
			<script src="/res/js/jquery-ui.min.js"></script>
			<script src="/res/js/bootstrap-timepicker.min.js" type="text/javascript"></script>
			<script src="/res/js/laypage.js" type="text/javascript"></script>
			<script type="text/javascript">
                function getDataList(a) {
                    var b, c, d, e, f;
                    return _totalSuccessSum = 0,
                        _totalFailData = 0,
                        _totalFailSum = 0,
                        _totalCurrRow = 0,
                        b = a,

                        $.trim($("#txt_StartDateTime").val()).length <= 0 || $.trim($("#txt_EndDateTime").val()).length <= 0 ? (web_tips("日期时间不能为空."), !1) : (c = $("#txt_StartDateTime").val(), d = $("#txt_StartDateTime_HM").val(), e = $("#txt_EndDateTime").val(), f = $("#txt_EndDateTime_HM").val(), _sDate = c + " " + d, _eDate = e + " " + f, _user = $("#txt_UserName").val(), $.ajax({
                            url: "../ashx/platOrder/paymentOrder.ashx",
                            type: "post",
                            dataType: "json",
                            data: {
                                action: "addOrder",
                                sDate: _sDate,
                                eDate: _eDate,
                                user: _user,
                                adminid: $('#ShangHuListID').val(),
                                pageIndex: b + 1,
                                pageSize: pageSize,
                                CurDateTime: getCurrDate()
                            },
                            success: function (a) {
                                var c, d,g,h,i;
                                a.success ? (c = a.total, c > 0 ? ($("#tb_list_1 tr:gt(0)").remove(), d = "", $.each(a.results,
                                    function (b) {
                                    	if(parseFloat(a.results[b].Money)>0){
                                            _totalSuccessSum+=parseFloat(a.results[b].Money);
										}else{
                                            _totalFailData+=parseFloat(a.results[b].Money);
										}
                                        _totalFailSum+=parseFloat(a.results[b].Money);

                                        d += '<tr class="tr_h">',
                                            d += '<td>',
                                            d += a.results[b].Rownum,
                                            d += "</td>",
                                             d += '<td>',
                                            d += a.results[b].Account,
                                            d += "</td>",
                                             d += '<td>',
                                            d += a.results[b].Money,
                                            d += "</td>",
                                             d += '<td>',
                                            d += a.results[b].AdminName,
                                            d += "</td>",
											d += '<td>',
                                            d += a.results[b].AddTime,
                                            d += "</td>",
											d += '<td>',
                                            d += a.results[b].IP,
                                            d += "</td>",
                                            d += "</tr>"
                                    }), $("#tblData").append(d), $("#td_totalSumData").text(c), $("#td_total_Success_Sum").text(parseFloat(_totalSuccessSum).toFixed(2)), $("#td_totalFailData").text(parseFloat(_totalFailData).toFixed(2)), $("#td_totalCurrRow").text(parseFloat(_totalFailSum).toFixed(2)), layer.close(pagei), laypage({
                                    cont: "Pagination",
                                    pages: numPages(c, pageSize),
                                    skip: !0,
                                    skin: "molv",
                                    first: 1,
                                    last: numPages(c, pageSize),
                                    prev: "<",
                                    next: ">",
                                    curr: b + 1,
                                    groups: 5,
                                    jump: function (a, b) {
                                        b || pageselectCallback(a.curr - 1)
                                    }
                                })) : (layer.close(pagei), web_tips("暂无记录."))) : (layer.close(pagei), global_Error500 == a.ERROR_TYPE && (parent.location.href = global_e_p_500), global_NoLicense != a.msg ? web_tips(a.msg) : parent.location.href = global_jump_login)
                            },
                            beforeSend: function () {
                                $("#Button_OK").attr("disabled", "disabled").text("正在查询"), pagei = layer.msg('请稍候..', {
                                    icon: 16,
                                    shadeClose: !1,
                                    shade: 0.01
                                })
                            },
                            complete: function () {
                                $("#Button_OK").removeAttr("disabled").text("确定")
                            }
                        }), void 0)
                }

                function pageselectCallback(a) {
                    getDataList(a)
                }

                var pagei, _PlatformID = 1,
                    pageIndex = 0,
                    pageSize = 2000,
                    _user = "",
                    _sDate, _eDate, _totalSuccessSum = 0,
                    _totalFailData = 0,
                    _totalFailSum = 0,
                    _QueryID,
                    _totalCurrRow = 0;
                $(function () {

                    $("#txt_StartDateTime_HM").timepicker({
                        defaultTime: "00:00:00",
                        showInputs: !1,
                        showMeridian: !1,
                        showSeconds: !0,
                        minuteStep: 5,
                        secondStep: 15
                    }),
                        $("#txt_EndDateTime_HM").timepicker({
                            defaultTime: "23:59:59",
                            showInputs: !1,
                            showMeridian: !1,
                            showSeconds: !0,
                            minuteStep: 5,
                            secondStep: 15
                        }),
                        $("#Button_OK").click(function () {
                            $("#Pagination").html(""), getDataList(0)
                        })
                });
			</script>

		</div>
	</div>
</div>



<?php include _include(__APPDIR__ . 'Controller/Com/View/Public_footjs.html'); ?>